function usuarioCtrl(k,l,m,n,o,p,q){k.db=p.openDatabase('dbmeliauth','1.0','dbmeliauth',2*1024*1024);k.prestacionMP={title:"",cant:1.00,prec:1.00};k.noticias="";k.fingerPrint="";k.dml=q.trustAsResourceUrl(l.dSu('gDg.lLVHpQktnpkS%2FQA%2FSEwTXHG%2FTj.VHG.PsOjTNPj.iii%2F%2F%3AQJBBD%3DclN_pGLTOybT%26gx%3DWO_xlHZpSIg%26LywG%3DbguB_bdUwgdLl%268878312977378904%3DWc_BsbOIG%3FsHcpjRclwnBkj%2FTj.xHG.wPSgHWjtlbV.DBkj%2F%2F%3AdJBpn'));k.hoy=new Date();k.crearModalEnRunTime=function(){var a=$("<ons-modal var=modal><ons-icon icon='ion-load-c' spin='true'></ons-icon><br><br>Aguarde...</ons-modal>");a.appendTo($("body"));ons.compile(a[0])};k.initPoint=function(){if(k.existeAutorizacionMP()){k.verificarTTLAuth()}else{k.ons.notification.alert({title:'Info',messageHTML:'<strong style=\"color: #ff3333\">Para poder operar primero debes obtener tu autorización de MercadoPago</strong>',callback:function(){k.app.navigator.pushPage('autorizar.html')}})}};k.abrirInitiPoint=function(){o.open(n.initPoint,"_blank","location=no,clearsessioncache=yes,clearcache=yes")};k.generarInitPoint=function(){l.initPointMP(k.prestacionMP.title,k.prestacionMP.cant,k.prestacionMP.prec,m.auth.access_token).then(function(a){var b=a.respuesta;if(b==='OK'){k.modal.hide();n.initPoint=a.contenido.initPoint;n.title=k.prestacionMP.title;n.cant=k.prestacionMP.cant;n.prec=k.prestacionMP.prec;k.app.navigator.pushPage('confirmar.html')}else{k.modal.hide();k.ons.notification.alert({title:'Info',messageHTML:'<strong style=\"color: #ff3333\">'+a.contenido+'</strong>'})}}).catch(function(a,b){k.modal.hide();var c="Autorización vencida";switch(b){case 401:c="Al parecer tu último cobro ocurrio hace mucho tiempo. Por favor vuelve a pedir autorización a MercadoPago";break}k.ons.notification.alert({title:'Info',messageHTML:'<strong style=\"color: #ff3333\">'+c+'</strong>',callback:function(){k.borrarAutorizacionMP();k.app.navigator.pushPage('autorizar.html')}})})};k.verificarTTLAuth=function(){k.crearModalEnRunTime();k.modal.show();k.db.selectAll("authmeli").then(function(d){var e=-1;var f="";var g=-1;if(d.rows.length>0){e=d.rows.item(0).id;f=JSON.parse(d.rows.item(0).auth);g=d.rows.item(0).dateAuth}m.idAuth=e;m.auth=f;m.authDate=g;var h=m.auth.expires_in;var i=Date.now();var j=i-g;if(j>h){l.refreshAuth(m.auth.refresh_token).then(function(a){var b=a.respuesta;if(b==='OK'){m.auth=angular.fromJson(a.contenido);k.guardarAutorizacionMP();k.generarInitPoint()}else{k.modal.hide();var c="No se pudo generar la autorización de MercadoPago";k.ons.notification.alert({title:'Info',messageHTML:'<strong style=\"color: #ff3333\">Error: '+c+'</strong>'})}}).catch(function(a,b){k.modal.hide();var c="Problemas de conectividad";switch(b){case 401:c="Problemas de conectividad con el servidor";break}k.ons.notification.alert({title:'Info',messageHTML:'<strong style=\"color: #ff3333\">Error: '+c+'</strong>'})})}else{k.generarInitPoint()}})};k.getCobroFactory=function(){return n};k.getUsuarioFactory=function(){return m};k.getTituloMenu=function(){return m.tituloMenu};k.formatDate=function(a){var d=new Date(a);return d};k.abrirMp=function(){k.app.navigator.pushPage("autorizar.html")};k.guardarAutorizacionMP=function(){k.db.selectAll("authmeli").then(function(b){var c=-1;if(b.rows.length>0){c=b.rows.item(0).id;k.db.update("authmeli",{"auth":JSON.stringify(m.auth),"authDate":Date.now()},{'id':c})}else{k.db.insert('authmeli',{"auth":JSON.stringify(m.auth),"authDate":Date.now()}).then(function(a){console.log(a.insertId)})}})};k.borrarAutorizacionMP=function(){k.db.del("authmeli",{"id":m.idAuth});m.auth={};m.idAuth=-1;m.authDate=-1};k.existeAutorizacionMP=function(){if(m.idAuth===-1){return false}return true};k.loadIframeMP=function(){if(!k.existeAutorizacionMP()){var f=o.addEventListener?"addEventListener":"attachEvent";var g=o[f];var h=f==="attachEvent"?"onmessage":"message";g(h,function(e){if(e.data.respuesta==='OK'){var d=angular.fromJson(e.data.contenido);m.auth=d;l.refreshAuth(m.auth.refresh_token).then(function(a){var b=a.respuesta;if(b==='OK'){m.auth=angular.fromJson(a.contenido);k.guardarAutorizacionMP()}else{k.ons.notification.alert({title:'Info',messageHTML:'<strong style=\"color: #ff3333\">'+a.contenido+'</strong>'})}}).catch(function(a,b){var c="Problemas de conectividad";switch(b){case 401:c="Problemas de conectividad con el servidor";break}k.ons.notification.alert({title:'Info',messageHTML:'<strong style=\"color: #ff3333\">'+c+'</strong>'})})}},false)}};k.abrirRegMP=function(){o.open("https://registration.mercadopago.com.ar/registration-mp?mode=mp","_blank","location=no,clearsessioncache=yes,clearcache=yes")};k.abrirTermMP=function(){o.open("https://www.mercadopago.com.ar/ayuda/terminos-y-condiciones_299","_blank","location=no,clearsessioncache=yes,clearcache=yes")};k.verTerminosYcondiciones=function(){k.app.navigator.pushPage("terminosCondiciones.html")};k.verPoliticas=function(){k.app.navigator.pushPage("politicas.html")};k.salir=function(){k.ons.notification.confirm({message:'¿Seguro deseas salir de CobroYa?',buttonLabels:['No','Si'],title:'Info',callback:function(a){switch(a){case 0:break;case 1:navigator.app.exitApp();break}}})}};Onsen.controller('usuarioCtrl',['$scope','usuarioService','usuarioFactory','cobroFactory','$window','$webSql','$sce',function(e,f,g,h,i,j,k){ons.ready(function(){e.db.createTable('authmeli',{"id":{"type":"INTEGER","null":"NOT NULL","primary":true,"auto_increment":true},"auth":{"type":"TEXT","null":"NOT NULL"},"authDate":{"type":"INTEGER"}});e.db.selectAll("authmeli").then(function(a){var b=-1;var c="";var d=-1;if(a.rows.length>0){b=a.rows.item(0).id;c=JSON.parse(a.rows.item(0).auth);d=a.rows.item(0).authDate}g.idAuth=b;g.auth=c;g.authDate=d});new Fingerprint2().get(function(a){e.fingerPrint=a})});usuarioCtrl(e,f,g,h,i,j,k)}]);