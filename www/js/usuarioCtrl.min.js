function usuarioCtrl(i,j,k,l,m,n,o){i.prestacionMP={title:"",cant:1.00,prec:1.00};i.noticias="";i.crearModalEnRunTime=function(){var a=$("<ons-modal var=modal><ons-icon icon='ion-load-c' spin='true'></ons-icon><br><br>Aguarde...</ons-modal>");a.appendTo($("body"));ons.compile(a[0])};i.initPoint=function(){if(i.existeAutorizacionMP()){i.verificarTTLAuth()}else{i.ons.notification.alert({title:'Info',messageHTML:'<strong style=\"color: #ff3333\">Para poder operar primero debes obtener tu autorización de MercadoPago</strong>',callback:function(){i.app.navigator.pushPage('autorizar.html')}})}};i.abrirInitiPoint=function(){m.open(l.initPoint,"_blank","location=no,clearsessioncache=yes,clearcache=yes")};i.generarInitPoint=function(){j.initPointMP(i.prestacionMP.title,i.prestacionMP.cant,i.prestacionMP.prec,k.auth.access_token).then(function(a){var b=a.respuesta;if(b==='OK'){i.modal.hide();l.initPoint=a.contenido.initPoint;l.title=i.prestacionMP.title;l.cant=i.prestacionMP.cant;l.prec=i.prestacionMP.prec;i.app.navigator.pushPage('confirmar.html')}else{i.modal.hide();i.ons.notification.alert({title:'Info',messageHTML:'<strong style=\"color: #ff3333\">'+a.contenido+'</strong>'})}}).catch(function(a,b){i.modal.hide();var c="Excepción inesperada.";switch(b){case 401:c="No autorizado.";break}i.ons.notification.alert({title:'Info',messageHTML:'<strong style=\"color: #ff3333\">Error: '+c+'</strong>'})})};i.verificarTTLAuth=function(){i.crearModalEnRunTime();i.modal.show();k.auth=n.auth;var d=k.auth.expires_in;var e=Date.now();var f=n.authDate;var g=e-f;if(g>d){j.refreshAuth(k.auth.refresh_token).then(function(a){var b=a.respuesta;if(b==='OK'){k.auth=angular.fromJson(a.contenido);i.guardarAutorizacionMP();i.generarInitPoint()}else{i.modal.hide();var c="No se pudo generar la autorización de MercadoPago";i.ons.notification.alert({title:'Info',messageHTML:'<strong style=\"color: #ff3333\">Error: '+c+'</strong>'})}}).catch(function(a,b){i.modal.hide();var c="Excepción inesperada.";switch(b){case 401:c="No autorizado.";break}i.ons.notification.alert({title:'Info',messageHTML:'<strong style=\"color: #ff3333\">Error: '+c+'</strong>'})})}else{i.generarInitPoint()}};i.getCobroFactory=function(){return l};i.getUsuarioFactory=function(){return k};i.getTituloMenu=function(){return k.tituloMenu};i.formatDate=function(a){var d=new Date(a);return d};i.abrirMp=function(){i.app.navigator.pushPage("autorizar.html")};i.guardarAutorizacionMP=function(){n.$reset();n.auth=k.auth;n.authDate=Date.now()};i.borrarAutorizacionMP=function(){n.$reset();k.auth=""};i.existeAutorizacionMP=function(){if(typeof(n.auth)==="undefined")return false;if(n.auth===""){return false}return true};i.loadIframeMP=function(){if(!i.existeAutorizacionMP()){var f=m.addEventListener?"addEventListener":"attachEvent";var g=m[f];var h=f==="attachEvent"?"onmessage":"message";g(h,function(e){if(e.data.respuesta==='OK'){var d=angular.fromJson(e.data.contenido);k.auth=d;j.refreshAuth(k.auth.refresh_token).then(function(a){var b=a.respuesta;if(b==='OK'){k.auth=angular.fromJson(a.contenido);i.guardarAutorizacionMP()}else{i.ons.notification.alert({title:'Info',messageHTML:'<strong style=\"color: #ff3333\">'+a.contenido+'</strong>'})}}).catch(function(a,b){var c="Excepción inesperada.";switch(b){case 401:c="No autorizado.";break}i.ons.notification.alert({title:'Info',messageHTML:'<strong style=\"color: #ff3333\">Error: '+c+'</strong>'})})}},false)}};i.abrirAguraIng=function(){m.open("http://www.agura.com.ar","_blank","location=no,clearsessioncache=yes,clearcache=yes")};i.verTerminosYcondiciones=function(){i.app.navigator.pushPage("terminosCondiciones.html")};i.verPoliticas=function(){i.app.navigator.pushPage("politicas.html")}};Onsen.controller('usuarioCtrl',['$scope','usuarioService','usuarioFactory','cobroFactory','$window','$localStorage','$document',function(a,b,c,d,e,f,g){ons.ready(function(){c.clientIdMp=f.clientIdMp;c.clientSecretMp=f.clientSecretMp});usuarioCtrl(a,b,c,d,e,f,g)}]);